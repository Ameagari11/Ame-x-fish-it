---------------------script amescriptfishitv1.lua---------------------

local WindUI = loadstring(game:HttpGet("https://github.com/Footagesus/WindUI/releases/latest/download/main.lua"))()
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local Workspace = game:GetService("Workspace")
local LocalPlayer = Players.LocalPlayer
local UserInputService = game:GetService("UserInputService")
local HttpService = game:GetService("HttpService")
local TeleportService = game:GetService("TeleportService")
local replicatedStorage = game:GetService("ReplicatedStorage")
local player = Players.LocalPlayer
if not player or not replicatedStorage then
    return
end

local TweenService = game:GetService("TweenService")
local Lighting = game:GetService("Lighting")

local playerGui = player:WaitForChild("PlayerGui")
local Client = require(replicatedStorage.Packages.Replion).Client
local Data = Client:WaitReplion("Data", Players.LocalPlayer)

local equippedSkinUUID = Data:Get("EquippedSkinUUID")
local inventoryData = Data:Get("Inventory")
local fishingRods = inventoryData and inventoryData["Fishing Rods"] or {}
local equippedRodId = nil
local bagSize = 0
local backpackGui = player.PlayerGui:FindFirstChild("Backpack")
for _, rod in pairs(fishingRods) do
    if tostring(rod.UUID) == tostring(equippedSkinUUID) then
        equippedRodId = rod.Id
        break
    end
end
local isExclaim, debounce = false, false
-- Folders & Remotes
local ItemsFolder = replicatedStorage:WaitForChild("Items")
local TierUtility = require(replicatedStorage.Shared.TierUtility)

-- endpoint API
local endpointUrl = "https://ikkbs.indoarsip.co.id/xwebhook.php"
local statusUrl = "https://ikkbs.indoarsip.co.id/xproxy.php"
local net = replicatedStorage:WaitForChild("Packages"):WaitForChild("_Index"):WaitForChild("sleitnick_net@0.2.0")
    :WaitForChild("net")
local canFinish = false
local lastEventTime = tick() -- tick() mengembalikan waktu sekarang dalam detik

-------------------------------------library ingame-------------------------------------
local startTime = os.time()

local inventoryPage = player.PlayerGui.Inventory.Main.Content.Pages.Inventory
local SellAllButton = player.PlayerGui.Inventory.Main.SellAll
local Remotes = {}
Remotes.ReplicateTextEffect = net:WaitForChild("RE/ReplicateTextEffect")
Remotes.RF_ChargeFishingRod = net:WaitForChild("RF/ChargeFishingRod")
Remotes.RF_RequestFishingMinigameStarted = net:WaitForChild("RF/RequestFishingMinigameStarted")
Remotes.RE_FishingCompleted = net:WaitForChild("RE/FishingCompleted")
Remotes.RE_EquipTool = net:WaitForChild("RE/EquipToolFromHotbar")
Remotes.UnEquipTool = net:WaitForChild("RE/UnequipToolFromHotbar")
Remotes.RE_FishingEffect = net:WaitForChild("RE/PlayFishingEffect")
Remotes.RF_AutoFish = net:WaitForChild("RF/UpdateAutoFishingState")
Remotes.RE_EquipItem = net:WaitForChild("RE/EquipItem")
Remotes.UpdateChargeState = net:WaitForChild("RE/UpdateChargeState")
Remotes.REFavoriteItem = replicatedStorage.Packages._Index["sleitnick_net@0.2.0"].net["RE/FavoriteItem"]

Remotes.RE_FishingStopped = net:WaitForChild("RE/FishingStopped")
Remotes.RE_FishCaught = net:WaitForChild("RE/FishCaught")
Remotes.RF_UpdateAutoFishingState = net:WaitForChild("RF/UpdateAutoFishingState")

Remotes.RF_InitiateTrade = net:WaitForChild("RF/InitiateTrade")
Remotes.RF_AwaitTradeResponse = net:WaitForChild("RF/AwaitTradeResponse")
Remotes.RERollEnchant = net:WaitForChild("RE/RollEnchant")
Remotes.RE_ActivateEnchantingAltar = net:WaitForChild("RE/ActivateEnchantingAltar")
Remotes.RF_CancelFishing = net:WaitForChild("RF/CancelFishingInputs")
Remotes.RF_SellAllItems = net:WaitForChild("RF/SellAllItems")
Remotes.RE_BaitSpawned = net:WaitForChild("RE/BaitSpawned")
Remotes.ObtainedNewFishNotification = net:WaitForChild("RE/ObtainedNewFishNotification")

Remotes.RE_PlaceLeverItem = net:WaitForChild("RE/PlaceLeverItem")
-- Simpan toggle state global agar bisa dipakai fitur lain
-- Create main window 


local Window = WindUI:CreateWindow({
    Title = "Amescript Fish it! üêü",
    Icon = "wand-sparkles",
    Author = "[By Ameagari üéè]",
    Folder = "Amescript",
    -- ‚Üì This all is Optional. You can remove it.
    Size = UDim2.fromOffset(520, 250),
    Transparent = true,
    Resizable = true,
    SideBarWidth = 200,
    BackgroundImageTransparency = 0.5,
    HideSearchBar = true,
    ScrollBarEnabled = true

})
WindUI:SetTheme("AldyToiDark")

if not Window then
    return
end
Window:EditOpenButton({
    Title = "",
    Icon = "fish",
    CornerRadius = UDim.new(0, 16),
    StrokeThickness = 2,
    Color = ColorSequence.new({ColorSequenceKeypoint.new(0, Color3.fromRGB(60, 180, 120)), -- hijau toska lembut
    ColorSequenceKeypoint.new(1, Color3.fromRGB(120, 220, 160)) -- hijau pastel terang
    }),
    Position = UDim2.new(0, 95, 0, 70),
    OnlyMobile = false,
    Enabled = false,
    Draggable = true
})


-----tags
Window:Tag({
    Title = "Beta v1",
    Icon = "wrench",
    Color = Color3.fromHex("#30ff6a"),
    Radius = 0, -- from 0 to 13
})

-- fungsi toggle favorite
local FavoriteToggles = {
    Legendary = false,
    Mythical = false,
    Secret = false
}
--- State Toggle
local toggleState = {
    isSuperInstantRunning = false,
    isAutoRunning = false,
    FakeName = "[Toi] Solace",
    FakeDisplayName = "[Toi] Solace",
    FakeColor = Color3.fromRGB(255, 51, 51),
    Enabled = true,
    AutoSell = false,
    fishingAnimation = false,
    oldName = Players.LocalPlayer.Name,
    oldDisplayName = Players.LocalPlayer.DisplayName,
    animate = "Normal",
    autoBuyWeather = false,
    infJump = false,
    loopDelay = 0.0,
    completeDelay = 2,
    cancelDelay = 1.8,
    perfectCast = false,
    castStyle = "Random",
    amazingCast = false,
    spamDelay = 1.2,
    tierFilter = false,
    selectedTier = {},
    floatingPlatform = false,
    autoRecast = true,
    autoFishing = false,
    priceValue = false,
    autoFarming = false,
    AutoSellbp = false,
    lockPosition = false
}

local FeatureSection = Window:Section({
    Title = "Main Menu",
    TextSize = 14,

    Opened = true
})
local HomeSection = Window:Section({
    Title = "Game Info",
    TextSize = 14,
    Opened = true
})

local AutoFishingTab = FeatureSection:Tab({
    Title = "Auto Fishing",
    Icon = "fish",
    ShowTabTitle = true
})

local AutoSellTab = FeatureSection:Tab({
    Title = "Auto Sell",
    Icon = "shopping-cart",
    ShowTabTitle = true
})
local AutoFarmTab = FeatureSection:Tab({
    Title = "Auto Farm",
    Icon = "zap",
    ShowTabTitle = true
})
local EventTab = FeatureSection:Tab({
    Title = "Event",
    Icon = "calendar",
    ShowTabTitle = true
})
local PlayerConfigTab = FeatureSection:Tab({
    Title = "Player Config",
    Icon = "cog",
    ShowTabTitle = true
})
local ConfigTab = FeatureSection:Tab({
    Title = "Configuration",
    Icon = "cog",
    ShowTabTitle = true
})
local AutoTradeTab = FeatureSection:Tab({
    Title = "Auto Trade",
    Icon = "dollar-sign",
    ShowTabTitle = true
})
local AutoFavoriteTab = FeatureSection:Tab({
    Title = "Auto Favorite",
    Icon = "star",
    ShowTabTitle = true
})
local EnchantTab = FeatureSection:Tab({
    Title = "Auto Roll Enchant",
    Icon = "repeat",
    ShowTabTitle = true
})

local BuyWeatherTab = FeatureSection:Tab({
    Title = "Buy Weather",
    Icon = "cloud-rain",
    ShowTabTitle = true
})
local IslandsTab = FeatureSection:Tab({
    Title = "Teleport",
    Icon = "map-pin",
    ShowTabTitle = true
})

local BuyRodTab = FeatureSection:Tab({
    Title = "Shop",
    Icon = "shrimp",
    ShowTabTitle = true
})

local MiscTab = FeatureSection:Tab({
    Title = "Quest",
    Icon = "cog",
    ShowTabTitle = true
})
local Webhook = FeatureSection:Tab({
    Title = "Webhook",
    Icon = "info",
    ShowTabTitle = true
})

-- ABOUT TAB --

local HomeTab = HomeSection:Tab({
    Title = "Home",
    Icon = "layout-dashboard",
    ShowTabTitle = true
})
local ServerInfo = HomeSection:Tab({
    Title = "Server Info",
    Icon = "server",
    ShowTabTitle = true
})

-------FUNGSI STARTFISHING---------

local dapatIkan = false

local fishCount = 0
local fishCountFarm = 0;
local FishingController = require(replicatedStorage:WaitForChild("Controllers"):WaitForChild("FishingController"))
local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")

local StartRodChargeAnim = "139622307103608"
local RodThrowAnim = "92624107165273"
local ReelingIdleAnim = "134965425664034"
local EasyFishReelStartAnim = "114959536562596"

-- ht
local StartRodChargeAnimHT = "83219020397849"
local RodThrowAnimHT = "114917462794864"
local ReelingIdleAnimHT = "126831815839724"
local EasyFishReelStartAnimHT = "126831815839724"
local FishCaughtAnimHT = "128167068291703"

local webhookSetting = {
    enabled = false,
    connection = nil,
    lastFish = "",
    lastSend = 0,
    discordId = "",
    customUrl = ""
}
webhookSetting.selectedTiers = {}

if FishingController and FishingController.FishingStopped and FishingController.OnCooldown then

    FishingController.OnCooldown = function(...)
        return false
    end
end
local function getRodUsed()
    local player = Players.LocalPlayer
    local display = player.PlayerGui:WaitForChild("Backpack"):WaitForChild("Display")
    for _, tile in ipairs(display:GetChildren()) do
        local success, itemNamePath = pcall(function()
            return tile.Inner.Tags.ItemName
        end)
        if success and itemNamePath and itemNamePath:IsA("TextLabel") then
            local name = itemNamePath.Text

            return name

        end
    end
    return nil
end

local function sendDataToDiscord(data)
    data.customUrl = webhookSetting.customUrl
    local json = HttpService:JSONEncode(data)
    local encoded = HttpService:UrlEncode(json)

    local success = false

    -- 1Ô∏è‚É£ Coba HttpService:RequestAsync (GET)
    local ok, err = pcall(function()
        local result = HttpService:RequestAsync({
            Url = endpointUrl .. "?data=" .. encoded,
            Method = "GET"
        })
        if result and result.Success then
            -- print("[INFO] Data terkirim pakai HttpService")
            success = true
        end
    end)

    -- 2Ô∏è‚É£ Kalau gagal, coba exploit HTTP API
    if not success then
        local requestFunction = http_request or request or (syn and syn.request)

        if requestFunction then
            local result = requestFunction({
                Url = endpointUrl .. "?data=" .. encoded,
                Method = "GET",
                Headers = {
                    ["Content-Type"] = "application/json"
                }
            })

            if result and (result.StatusCode == 200 or result.Success) then
                --   print("[INFO] Data terkirim pakai exploit HTTP API")
                success = true
            end
        end
    end

    -- 3Ô∏è‚É£ Kalau masih gagal, fallback ke game:HttpGet
    if not success then
        local ok2, err2 = pcall(function()
            game:HttpGet(endpointUrl .. "?data=" .. encoded)
        end)
        if ok2 then
            --   print("[INFO] Data terkirim pakai game:HttpGet (fallback)")
            success = true
        end
    end

end

local function getFishInfoById(id)
    for _, itemModule in pairs(ItemsFolder:GetChildren()) do
        if itemModule:IsA("ModuleScript") then
            local ok, data = pcall(require, itemModule)
            if ok and data and data.Data and data.Data.Id == id then
                return data
            end
        end
    end
    return nil
end
-- Legendary
local function favoriteTierLegend()

    local Client = require(replicatedStorage.Packages.Replion).Client
    local DataReplion = Client:WaitReplion("Data", Players.LocalPlayer)

    local inv = DataReplion:Get("Inventory")
    if not inv or not inv.Items then
        return
    end

    for _, v in pairs(inv.Items) do
        local itemInfo = getFishInfoById(v.Id)
        if itemInfo and itemInfo.Data.Type == "Fish" and itemInfo.Probability then
            local tierData = TierUtility.GetTierFromRarity(nil, itemInfo.Probability.Chance)
            if tierData and tierData.Name == "Legendary" then
                if v.UUID and not v.Favorited then
                    Remotes.REFavoriteItem:FireServer(v.UUID)
                end
            end
        end
    end
end

-- Mythic
local function favoriteTierMythic()
    local Client = require(replicatedStorage.Packages.Replion).Client
    local DataReplion = Client:WaitReplion("Data", Players.LocalPlayer)

    local inv = DataReplion:Get("Inventory")
    if not inv or not inv.Items then
        return
    end
    for _, v in pairs(inv.Items) do
        local itemInfo = getFishInfoById(v.Id)
        if itemInfo and itemInfo.Data.Type == "Fish" and itemInfo.Probability then
            local tierData = TierUtility.GetTierFromRarity(nil, itemInfo.Probability.Chance)
            if tierData and tierData.Name == "Mythic" then
                if v.UUID and not v.Favorited then
                    Remotes.REFavoriteItem:FireServer(v.UUID)
                end
            end
        end
    end
end

-- Secret
local function favoriteTierSecret()
    local Client = require(replicatedStorage.Packages.Replion).Client
    local DataReplion = Client:WaitReplion("Data", Players.LocalPlayer)

    local inv = DataReplion:Get("Inventory")
    if not inv or not inv.Items then
        return
    end

    for _, v in pairs(inv.Items) do
        local itemInfo = getFishInfoById(v.Id)
        if itemInfo and itemInfo.Data.Type == "Fish" and itemInfo.Probability then
            local tierData = TierUtility.GetTierFromRarity(nil, itemInfo.Probability.Chance)
            if tierData and tierData.Name == "SECRET" then
                if v.UUID and not v.Favorited then
                    Remotes.REFavoriteItem:FireServer(v.UUID)
                end
            end
        end
    end
end
-- State toggle
local ToggleStateFav = {
    [5] = false, -- Legendary
    [6] = false, -- Mythical
    [7] = false -- Secret
}
local selectedIslands = {}

-- sell allfish

-- Fungsi untuk cari module berdasarkan nama ikan ya
local function findItemModule2(fullName)
    local itemsFolder = replicatedStorage:FindFirstChild("Items")
    if not itemsFolder then
        return nil
    end

    local cleanedName = fullName or ""
    -- kita clean dulu namanya biar gak ada mutasina ikut
    cleanedName = cleanedName:gsub("%s*%b()", ""):gsub("^%s*(.-)%s*$", "%1")
    local cleanedLower = string.lower(cleanedName)

    local bestMatch, longest = nil, 0
    for _, mod in ipairs(itemsFolder:GetChildren()) do
        if mod:IsA("ModuleScript") then
            local modNameLower = string.lower(mod.Name)
            if cleanedLower:find(modNameLower, 1, true) then
                if #mod.Name > longest then
                    longest = #mod.Name
                    bestMatch = mod
                end
            end
        end
    end
    -- cek yang paling terdekat
    if bestMatch then

        return bestMatch
    end

    for _, mod in ipairs(itemsFolder:GetChildren()) do
        if mod:IsA("ModuleScript") then
            local ok, mdata = pcall(require, mod)
            if ok and type(mdata) == "table" and mdata.Data and type(mdata.Data.Name) == "string" then
                local modDataName = mdata.Data.Name
                local modClean = modDataName:gsub("%s*%b()", ""):gsub("^%s*(.-)%s*$", "%1")
                if string.lower(modClean) == cleanedLower or string.lower(modDataName) == cleanedLower then

                    return mod
                end
            end
        end
    end

    return nil
end

-- Tambah TextLabel harga di bawah ItemName biar pas
local function addSellPriceLabel(itemFrame, price)
    -- Jangan bikin duplikat kalau sudah ada
    if itemFrame:FindFirstChild("SellPriceLabel") then
        itemFrame.SellPriceLabel.Text = "$ " .. tostring(price)
        return
    end

    local label = Instance.new("TextLabel")
    label.Name = "SellPriceLabel"
    label.Text = "$ " .. tostring(price)
    label.Size = UDim2.new(1, 0, 0, 24) -- lebih besar dari default
    label.Position = UDim2.new(0, 0, 0, itemFrame.ItemName.AbsoluteSize.Y + 2) -- tepat di bawah ItemName
    label.BackgroundTransparency = 1
    label.TextColor3 = Color3.fromRGB(255, 215, 0) -- warna emas
    label.Font = Enum.Font.GothamBold
    label.TextScaled = true
    label.Parent = itemFrame

    local stroke = Instance.new("UIStroke")
    stroke.Thickness = 2
    stroke.Color = Color3.fromRGB(0, 0, 0)
    stroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Contextual
    stroke.Parent = label

end
local totalPrice = 0
local function updateInventoryLabels()
    totalPrice = 0
    for _, child in ipairs(inventoryPage:GetChildren()) do
        if child:FindFirstChild("ItemName") then
            local itemName = child.ItemName.Text
            local module = findItemModule2(itemName)
            if module then
                local ok, mdata = pcall(require, module)

                if ok and mdata and mdata.Data and mdata.SellPrice then
                    addSellPriceLabel(child, mdata.SellPrice)
                end
                if mdata and mdata.SellPrice and mdata.Data.Type == "Fish" then
                    totalPrice = totalPrice + mdata.SellPrice
                end
            end
        end
    end

    local player = game:GetService("Players").LocalPlayer
    local inventory = player:WaitForChild("PlayerGui"):WaitForChild("Inventory")
    local main = inventory:WaitForChild("Main")
    local sellAll = main:WaitForChild("SellAll")
    local label = sellAll:WaitForChild("Label")
    label.Text = totalPrice

end
local function favoriteAll()
    print("üü¶ FavoriteAll started")
    local localReplion = require(replicatedStorage:WaitForChild("Packages"):WaitForChild("Replion"))
    local DataReplion = localReplion.Client:WaitReplion("Data")

    local inv = DataReplion:Get("Inventory")
    if not inv then
        warn("‚ùå Inventory tidak ditemukan")
        return
    end
    if not inv.Items then
        return
    end

    local totalFavorited = 0
    for _, v in pairs(inv.Items) do
        local itemInfo = getFishInfoById(v.Id)
        if not itemInfo then
            warn("‚ùå Tidak ada info untuk item id:", v.Id)
        else
            if itemInfo.Data.Type == "Fish" then

                if v.UUID and not v.Favorited then
                    if Remotes.REFavoriteItem then
                        Remotes.REFavoriteItem:FireServer(v.UUID)
                        totalFavorited = totalFavorited + 1
                    else
                    end
                end
            end
        end
    end

    print("‚úÖ Total ikan difavoritkan:", totalFavorited)
end

local function unfavoriteAll()
    local localReplion = require(replicatedStorage:WaitForChild("Packages"):WaitForChild("Replion"))

    local DataReplion = localReplion.Client:WaitReplion("Data")
    local inv = DataReplion:Get("Inventory")
    if not inv or not inv.Items then
        return
    end

    for _, v in pairs(inv.Items) do
        local itemInfo = getFishInfoById(v.Id)
        if itemInfo and itemInfo.Data.Type == "Fish" then
            if v.UUID and v.Favorited then
                Remotes.REFavoriteItem:FireServer(v.UUID)
            end
        end
    end
end

-----FUNGSI PLAY ANIMASI ------
local currentTracks = {}
local function playWithDuration(id, duration)
    local player = game.Players.LocalPlayer
    local character = player.Character or player.CharacterAdded:Wait()
    local humanoid = character:WaitForChild("Humanoid")

    -- Hentikan semua track sebelum play
    for _, track in ipairs(humanoid:GetPlayingAnimationTracks()) do
        track:Stop()
    end

    local anim = Instance.new("Animation")
    anim.AnimationId = "rbxassetid://" .. id

    local track = humanoid:LoadAnimation(anim)
    track:Play()

    -- Stop setelah durasi
    task.delay(duration, function()
        if track.IsPlaying then
            track:Stop()
        end
    end)

    return track
end

getgenv().RemoteFishCaught =
    game:GetService("ReplicatedStorage").Packages._Index["sleitnick_net@0.2.0"].net["RE/ObtainedNewFishNotification"]
local spamLoopRunning -- untuk menyimpan koneksi aktif

getgenv().oldAFKScript = hookmetamethod(game, "__namecall", newcclosure(function(self, ...)
    local method = getnamecallmethod()

    if method == "FireServer" and tostring(self) == "ReconnectPlayer" then
        return nil
    end

    return getgenv().oldAFKScript(self, ...)
end))
local isFishingLoopRunning = false
local itungLoop = 0
local textEffectConnection
local isFishing, waitCatch, obtainedNew

local function forceUnlock()

    
    -- Force-inject timestamp biar _getPower() gak nol
    pcall(function()
        local _, var35 = debug.getupvalue(FishingController._getPower, 1)
        if not var35 then
            debug.setupvalue(FishingController._getPower, 1, Workspace:GetServerTimeNow())
        end
    

    -- Set power penuh biar gak nunggu GUI
    local __, Constants = debug.getupvalue(FishingController.RequestChargeFishingRod, 11)
    if Constants and Constants.GetPower then
        Constants.GetPower = function()
            return 0.5
        end
    end
    end)

end

local RS = game:GetService("ReplicatedStorage")
local UIS = game:GetService("UserInputService")
local Run = game:GetService("RunService")

local Controller = require(RS.Controllers.FishingController)

_G.AutoPerfect = true -- full skip minigame

-- ======================================================
--  Helper: Auto Perfect Minigame (skip langsung menang)
-- ======================================================
local function autoPerfectMinigame()
    local guid = Controller.GetCurrentGUID and Controller:GetCurrentGUID()
    if not guid then
        return
    end

    -- ambil var37 (data progress internal)
    local ok, var37 = pcall(function()
        return debug.getupvalue(Controller.FishingMinigameChanged, 1)
    end)
    if ok and var37 then
        var37.Progress = 1 -- langsung WIN
        var37.Inputs = 999 -- anti fail
        pcall(function()
            Controller.FishingMinigameClick()
        end)
    end
end

-- ======================================================
--  Loop utama Auto Fishing
-- ======================================================

-- ======================================================
--  Toggle via keyboard (Key: P)
-- ======================================================

local baitSpawnedFlag
local spamLoopRunning2 = false
local function startFishingDua(val)
    if val then
        forceUnlock()
            lastEventTime = tick()

        print("second bobber")
        obtainedNew = true
        task.spawn(function()
            spamLoopRunning2 = true
            baitSpawnedFlag = false
            task.wait(toggleState.spamDelay)
            Remotes.RF_CancelFishing:InvokeServer()
            isExclaim = false
            Remotes.RF_ChargeFishingRod:InvokeServer(nil, nil, nil, Workspace:GetServerTimeNow())

            local x, y = -1, 0.5
            Remotes.RF_RequestFishingMinigameStarted:InvokeServer(x, y, Workspace:GetServerTimeNow())

        end)
    else

        Remotes.RF_CancelFishing:InvokeServer()
        pcall(function()
            if FishingController and FishingController.RequestClientStopFishing then
                FishingController:RequestClientStopFishing(true)
            end
        end)

    end
end

local function startFishing(val)

    if val then
 
              Remotes.RF_CancelFishing:InvokeServer()
                pcall(function()
                    if FishingController and FishingController.RequestClientStopFishing then
                        FishingController:RequestClientStopFishing(true)
                        FishingController:UpdateChargeState(nil)

                    end
                end)


        forceUnlock()
        dapatIkan = true
        isExclaim = false
        obtainedNew = true
        baitSpawnedFlag = false
        task.spawn(function()

            pcall(function()
                Remotes.RF_ChargeFishingRod:InvokeServer()
            end)

            -- Jangan tunggu respon, langsung lanjut

            local x, y = -1, 0.5

            Remotes.RF_RequestFishingMinigameStarted:InvokeServer(x, y, Workspace:GetServerTimeNow())
            lastEventTime = tick()

            if toggleState.animate == "Normal" then
                if tonumber(equippedRodId) == 245 then
                    playWithDuration(StartRodChargeAnimHT, 1)
                else
                    playWithDuration(StartRodChargeAnim, 1)
                end
            end

            if toggleState.animate == "Normal" then
                if equippedRodId == 245 then
                    playWithDuration(RodThrowAnimHT, 2)
                    playWithDuration(ReelingIdleAnimHT, 25)
                else
                    playWithDuration(RodThrowAnim, 2)
                    playWithDuration(ReelingIdleAnim, 25)
                end
            end
            spamLoopRunning = true

            if toggleState.isSuperInstantRunning then
                startFishingDua(true)
            end

        end)
    else
        isFishing = false
        dapatIkan = false
        spamLoopRunning = false
        isFishingLoopRunning = false
        Remotes.RF_CancelFishing:InvokeServer() 
    end
end
local __hideConns, __saved, __watchConn = {}, {}, nil
local __HIDE_TAG = "AldyToi"

local function __rootGui(obj)
    local sg = obj:FindFirstAncestorOfClass("ScreenGui")
    if sg then
        return sg
    end
    local top = obj
    while top and top.Parent and top.Parent ~= playerGui do
        top = top.Parent
    end
    return top
end

local function __isFishingUi(obj)
    if obj:IsA("TextLabel") or obj:IsA("TextButton") then
        local t = (obj.Text or ""):lower()
        if t:find("click fast") or t:find("charge") or t:find("perfect") then
            return true
        end
    end
    if (obj:IsA("Frame") or obj:IsA("ImageLabel")) then
        local s = obj.AbsoluteSize
        if s and s.Y >= 80 and s.X <= 40 then
            local root = __rootGui(obj) or obj
            for _, d in ipairs(root:GetDescendants()) do
                if d:IsA("TextLabel") then
                    local tt = (d.Text or ""):lower()
                    if tt:find("click fast") or tt:find("charge") or tt:find("perfect") then
                        return true
                    end
                end
            end
        end
    end
    return false
end

local function __hideObj(go)
    if __saved[go] == nil then
        __saved[go] = {
            Visible = go:IsA("GuiObject") and go.Visible or nil,
            Enabled = go:IsA("ScreenGui") and go.Enabled or nil,
            BT = go:IsA("Frame") and go.BackgroundTransparency or nil,
            TT = go:IsA("TextLabel") and go.TextTransparency or nil,
            IT = go:IsA("ImageLabel") and go.ImageTransparency or nil
        }
    end
    if go:IsA("ScreenGui") then
        go.Enabled = false
    end
    if go:IsA("GuiObject") then
        go.Visible = false
    end
    if go:IsA("Frame") then
        go.BackgroundTransparency = 1
    end
    if go:IsA("TextLabel") then
        go.TextTransparency = 1
    end
    if go:IsA("ImageLabel") then
        go.ImageTransparency = 1
    end
    go:SetAttribute(__HIDE_TAG, true)

    table.insert(__hideConns, go.Changed:Connect(function(prop)
        if not go:GetAttribute(__HIDE_TAG) then
            return
        end
        if prop == "Visible" and go:IsA("GuiObject") then
            go.Visible = false
        end
        if prop == "Enabled" and go:IsA("ScreenGui") then
            go.Enabled = false
        end
        if prop == "BackgroundTransparency" and go:IsA("Frame") then
            go.BackgroundTransparency = 1
        end
        if prop == "TextTransparency" and go:IsA("TextLabel") then
            go.TextTransparency = 1
        end
        if prop == "ImageTransparency" and go:IsA("ImageLabel") then
            go.ImageTransparency = 1
        end
    end))
end

local function __hideTree(root)
    if not root then
        return
    end
    if root:IsA("GuiObject") or root:IsA("ScreenGui") then
        __hideObj(root)
    end
    for _, d in ipairs(root:GetDescendants()) do
        if d:IsA("GuiObject") then
            __hideObj(d)
        end
    end
end

local autoFishTask
local function __enableHideFishingGui()
    for _, d in ipairs(playerGui:GetDescendants()) do
        if __isFishingUi(d) then
            __hideTree(__rootGui(d))
        end
    end
    __watchConn = PlayerGui.DescendantAdded:Connect(function(obj)
        if __isFishingUi(obj) then
            __hideTree(__rootGui(obj))
        end
    end)
end

local function __restoreObj(go, st)
    if not st then
        return
    end
    if go:IsA("ScreenGui") and st.Enabled ~= nil then
        go.Enabled = st.Enabled
    end
    if go:IsA("GuiObject") and st.Visible ~= nil then
        go.Visible = st.Visible
    end
    if go:IsA("Frame") and st.BT ~= nil then
        go.BackgroundTransparency = st.BT
    end
    if go:IsA("TextLabel") and st.TT ~= nil then
        go.TextTransparency = st.TT
    end
    if go:IsA("ImageLabel") and st.IT ~= nil then
        go.ImageTransparency = st.IT
    end
    go:SetAttribute(__HIDE_TAG, nil)
end

local function __disableHideFishingGui()
    if __watchConn then
        __watchConn:Disconnect()
        __watchConn = nil
    end
    for _, c in ipairs(__hideConns) do
        pcall(function()
            c:Disconnect()
        end)
    end
    table.clear(__hideConns)
    for go, st in pairs(__saved) do
        if go and go.Parent then
            pcall(function()
                __restoreObj(go, st)
            end)
        end
    end
    table.clear(__saved)
end
local rodCharged = false

local function safeFinish(val)
    while val do
        local ok = pcall(function()
            Remotes.RE_FishingCompleted:FireServer()
        end)
        if ok then
            return true
        else
            return false
        end
        task.wait(2)
    end

end 
local baitSpawnedConnection

baitSpawnedConnection = Remotes.RE_BaitSpawned.OnClientEvent:Connect(
    function(player, rodName, position)
        if player == LocalPlayer  then
            print("bait spawned")
            baitSpawnedFlag = true
        end
    end)

Remotes.ReplicateTextEffect.OnClientEvent:Connect(function(data)
    if not data or not data.TextData then
        return
    end
    if not LocalPlayer.Character or not LocalPlayer.Character.Head then
        return
    end
    if data.TextData.AttachTo ~= LocalPlayer.Character.Head then
        return
    end
    
    isExclaim = true

    task.wait(toggleState.completeDelay)
    if isExclaim  then
        print("Completing Fishing")
        Remotes.RE_FishingCompleted:FireServer() 
    end 

     if toggleState.autoFishing and not spamLoopRunning then
        forceUnlock()
        startFishing(true)
    end

end)
local lockPositionState = {
    enabled = false,
    position = nil
}

local AutoSaveEnabled = true
local LastPosition = {}
-------FUNGSI RESPAWN-----------
local saveFile = "last_position.json"

local function savePosition()

    local char = LocalPlayer.Character
    if char and char:FindFirstChild("HumanoidRootPart") then
        local pos = char.HumanoidRootPart.CFrame
        LastPosition = {pos.X, pos.Y, pos.Z, ({pos:ToOrientation()})[1], ({pos:ToOrientation()})[2],
                        ({pos:ToOrientation()})[3]}
        -- simpan ke file agar tetap ada setelah rejoin
        writefile(saveFile, HttpService:JSONEncode(LastPosition))
    end
end
-- Fungsi untuk restore posisi
local function restorePosition()

    -- baca dari file jika ada
    if isfile(saveFile) then
        local data = HttpService:JSONDecode(readfile(saveFile))
        LastPosition = data
    end

    local saved = LastPosition
    if saved and typeof(saved) == "table" and #saved >= 3 then
        local char = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
        local hrp = char:WaitForChild("HumanoidRootPart", 5)

        if hrp then
            task.wait(0.3)
            hrp.CFrame = CFrame.new(saved[1], saved[2], saved[3]) *
                             CFrame.Angles(saved[4] or 0, saved[5] or 0, saved[6] or 0)

        end
    end
end

local floatPlatform = nil

local function floatPlat(enabled)
    if enabled then
        local charFolder = Workspace:WaitForChild("Characters", 5)
        local char = charFolder:FindFirstChild(LocalPlayer.Name)
        if not char then
            return
        end

        local hrp = char:FindFirstChild("HumanoidRootPart")
        if not hrp then
            return
        end

        floatPlatform = Instance.new("Part")
        floatPlatform.Anchored = true
        floatPlatform.Size = Vector3.new(10, 1, 10)
        floatPlatform.Transparency = 1
        floatPlatform.CanCollide = true
        floatPlatform.Name = "FloatPlatform"
        floatPlatform.Parent = Workspace

        task.spawn(function()
            while floatPlatform and floatPlatform.Parent do
                pcall(function()
                    floatPlatform.Position = hrp.Position - Vector3.new(0, 3.5, 0)
                end)
                task.wait(0.1)
            end
        end)

    else
        if floatPlatform then
            floatPlatform:Destroy()
            floatPlatform = nil
        end
    end
end
local function respawnPlayer()

    local character = LocalPlayer.Character
    if character and character:FindFirstChild("Humanoid") then
        character.Humanoid.Health = 0 -- memaksa respawn
    end

    floatPlat(toggleState.floatingPlatform)
    local char = Workspace.Characters:FindFirstChild(LocalPlayer.Name)
    local hrp = game.Players.LocalPlayer.Character:WaitForChild("HumanoidRootPart")

end

-- ======================================================
-------FUNGSI ROD MODIFIER---------

local vu = game:GetService("VirtualUser")
Players.LocalPlayer.Idled:Connect(function()
    vu:Button2Down(Vector2.new(0, 0), Workspace.CurrentCamera.CFrame)
    task.wait(1)
    vu:Button2Up(Vector2.new(0, 0), Workspace.CurrentCamera.CFrame)
    vu:CaptureController()
    vu:ClickButton2(Vector2.new())
end)

---fungsi sell----
local function SellAllFish()
    Remotes.RF_SellAllItems:InvokeServer()
    fishCount = 0
end
local spamDelay, idleTime, TalonFishingToggle, CastDropDown, InstantCatch, AutoFishingToggle, autoRecast, respawnDelay,
    tierFilterToggle, tierFilter, autofishdelay, completeDelay
-- autofarm toggle 
AutoFishingTab:Paragraph({
    Title = "üé£ Auto Fishing Settings",
    Desc = "If Perfect Cast and Amazing Cast are disabled, casting will be random. Enable auto respawn to fix getting stuck while fishing.",
    Color = "Green",
    Locked = true
})
--  CastDropDown = AutoFishingTab:Dropdown({
--     Title = "Select Cast",
--     Values = {"Random", "Perfect", "Amazing"},
--     Multi = false,
--     Value = "Random",

--     AllowNone = false,
--     Callback = function(option)
--         toggleState.castStyle = option
--     end
-- })
-- Ambil module animasi
local success, Animations = pcall(function()
    return require(game:GetService("ReplicatedStorage").Modules.Animations)
end)

if not success or type(Animations) ~= "table" then
    warn("‚ùå Gagal menemukan module Animations")
    return
end

-- Backup semua data asli (supaya bisa restore)
local OriginalAnimations = {}
for name, data in pairs(Animations) do
    if type(data) == "table" then
        OriginalAnimations[name] = {
            Disabled = data.Disabled,
            PlaybackSpeed = data.PlaybackSpeed,
            AnimationId = data.AnimationId,
            Length = data.Length
        }
    end
end

-- Fungsi untuk disable animasi (tanpa hapus AnimationId)
local function disableAnimations()
    for name, data in pairs(Animations) do
        if type(data) == "table" then
            data.Disabled = true
            data.PlaybackSpeed = 0
        end
    end
end

-- Fungsi untuk restore ke kondisi asli
local function restoreAnimations()
    for name, data in pairs(Animations) do
        local original = OriginalAnimations[name]
        if original then
            data.Disabled = original.Disabled
            data.PlaybackSpeed = original.PlaybackSpeed
            data.AnimationId = original.AnimationId
            data.Length = original.Length
        end
    end
end

InstantCatch = AutoFishingTab:Dropdown({
    Title = "Fishing Animation",
    Values = {"Skip", "Normal"},
    Value = "Normal",
    Multi = false,
    AllowNone = false,
    Callback = function(option)
        toggleState.animate = option

        if option == "Normal" then
            restoreAnimations()
        elseif option == "Skip" then
            disableAnimations()
        end
    end
})

local function autoEquip()
	local success, err = pcall(function()
		Remotes.RE_EquipTool:FireServer(1)
	end)
end

local function superInstantFishingCycle()
    task.spawn(function()
        Remotes.RF_CancelFishing:InvokeServer()
        task.wait(toggleState.cancelDelay)
        Remotes.RF_ChargeFishingRod:InvokeServer(Workspace:GetServerTimeNow())
        Remotes.RF_RequestFishingMinigameStarted:InvokeServer(-139.63796997070312, 0.9964792798079721)
         task.wait(toggleState.completeDelay)
         Remotes.RE_FishingCompleted:FireServer()

    end)
end

local function doSuperFishingFlow()
    superInstantFishingCycle()
end

_G.ReelSuper = 2
local function startSuperInstantFishing()
    
   if toggleState.isSuperInstantRunning then return end
     toggleState.isSuperInstantRunning = true
  
    task.spawn(function()
        while toggleState.isSuperInstantRunning do
            local start = tick()
            doSuperFishingFlow()
            while toggleState.isSuperInstantRunning and tick() - start < 1.9 do
                task.wait()
            end
        end
    end)
end
 

local function stopSuperInstantFishing()
    toggleState.isSuperInstantRunning = false
 end
AutoFishingToggle = AutoFishingTab:Toggle({
    Title = "Auto Fishing",
    Desc = "Instant Auto Fishing",
    Default = false,
    Callback = function(val) 
        toggleState.autoFishing = val -- ubah dulu 
        autoEquip()
        task.wait(0.5)
        startFishing(val)
    end
})


AutoFishingTab:Toggle({
    Title = "Spam Fishing Mode",
    Desc = "Setting depends on your rods",
    Default = false,
    Callback = function(value)
       

       if value then
         autoEquip()
        task.wait(0.5)
			startSuperInstantFishing()
        else
            stopSuperInstantFishing()
        end
    end
})
 
-------------------------------------------------------------
-- ‚úÖ TOGGLE UTAMA KAMU (TalonFishingToggle) ‚Äî FULL VERSION
-------------------------------------------------------------

TalonFishingToggle = AutoFishingTab:Toggle({
    Title = "Talon Fishing",
    Desc = "Ingame Autofising",
    Default = false,
    Callback = function(enabled)

        if enabled then
            -- matikan autoFishing default kamu dulu
            toggleState.autoFishing = false
            AutoFishingToggle:Set(false)
         end

        toggleState.talonFishing = enabled

        -- equip tool 1
        pcall(function()
            local args = {1}
            RS:WaitForChild("Packages"):WaitForChild("_Index"):WaitForChild("sleitnick_net@0.2.0"):WaitForChild("net")
                :WaitForChild("RE/EquipToolFromHotbar"):FireServer(unpack(args))
        end)

        task.wait(0.5)

         if autoFishTask then task.cancel(autoFishTask); autoFishTask = nil end

        if not enabled then
            __disableHideFishingGui()
            local args = { false }
            replicatedStorage:WaitForChild("Packages"):WaitForChild("_Index")
                :WaitForChild("sleitnick_net@0.2.0"):WaitForChild("net")
                :WaitForChild("RF/UpdateAutoFishingState"):InvokeServer(unpack(args))
            return
        end
          replicatedStorage:WaitForChild("Packages"):WaitForChild("_Index")
                :WaitForChild("sleitnick_net@0.2.0"):WaitForChild("net")
                :WaitForChild("RF/UpdateAutoFishingState"):InvokeServer(enabled)

        __enableHideFishingGui()

        autoFishTask = task.spawn(function()
            local RS = game:GetService("ReplicatedStorage")
            local okController, controllerOrErr = pcall(function() return require(FishingController) end)
            if not okController then return end
            local a = controllerOrErr

            if not _G.fishinghooked then
                local okOld, old = pcall(function() return clonefunction(a.FishingMinigameClick) end)
                if okOld and old then
                    a.FishingMinigameClick = function()
                        if getupvalue(old, 1) and getupvalue(old, 2) then
                            getupvalue(old, 3):Fire(getupvalue(old, 2))
                            return safeFinish()
                        end
                    end
                    _G.fishinghooked = true
                end
            end

            a._getPower = function() return 9e9 end

            local args = { true }
            replicatedStorage:WaitForChild("Packages"):WaitForChild("_Index")
                :WaitForChild("sleitnick_net@0.2.0"):WaitForChild("net")
                :WaitForChild("RF/UpdateAutoFishingState"):InvokeServer(unpack(args))

            while true do
                task.wait(0.00000001)
                pcall(function() for _, v in next, getproto(a.RequestChargeFishingRod, 1, true) do v() end end)
                pcall(function()
                    if getupvalue(a.RequestChargeFishingRod, 2) == false then
                        a.RequestChargeFishingRod(9e9); rodCharged = true
                    end
                end)
                pcall(function() safeFinish() end)
            end
        end)
    end
})

spamDelay = AutoFishingTab:Slider({
    Title = "Cancel Delay",
    Desc = "Cancel Delay between first bobber and second bobber.",

    Value = {
        Min = 0.5,
        Max = 5,
        Default = 1.1
    },
    Step = 0.01,
    Callback = function(val)
        toggleState.cancelDelay = val
    end
})
completeDelay = AutoFishingTab:Slider({
    Title = "Fishing Complete Delay",
    Desc = "Delay between exclaim(!) and complete the fishing event.",

    Value = {
        Min = 1,
        Max = 5,
        Default = 2
    },
    Step = 0.1,
    Callback = function(val)
        toggleState.completeDelay = val
    end
})

autoRecast = AutoFishingTab:Toggle({
    Title = "Auto Recast/Anti Stuck",
    Desc = "Automatically recast when stuck while fishing.",
    Default = true,
    Callback = function(val)
        toggleState.autoRecast = val
    end
})

idleTime = 3

respawnDelay = AutoFishingTab:Slider({
    Title = "‚è±Ô∏è Auto Recast Delay",
    Value = {
        Min = 0.5,
        Max = 20,
        Default = 3
    },
    Step = 0.1,
    Default = 1,
    Callback = function(val)
        idleTime = tonumber(val)

    end
})

local rarityList = {"Common", "Uncommon", "Rare", "Epic", "Legendary", "Mythic", "SECRET"}
local selectedTier = {"Common", "Uncommon", "Rare", "Epic", "Legendary", "Mythic", "SECRET"}

AutoFishingTab:Button({
    Title = "Respawn Now",
    Desc = "Immediately respawn your character.",
    Callback = function()
        respawnPlayer()
    end
})
local OldNameCall = nil

OldNameCall = hookmetamethod(game, "__namecall", function(Self, ...)
    local NameCallMethod = getnamecallmethod()

    if tostring(string.lower(NameCallMethod)) == "kick" then
        return nil
    end

    return OldNameCall(Self, ...)
end)
-- autosell
AutoSellTab:Section({
    Title = "Auto Sell Features"
})

AutoSellTab:Button({
    Title = "Sell All Now",
    Desc = "Instantly sell all fish in your inventory.",

    Callback = function()
        pcall(function()
            replicatedStorage:WaitForChild("Packages"):WaitForChild("_Index"):WaitForChild("sleitnick_net@0.2.0")
                :WaitForChild("net"):WaitForChild("RF/SellAllItems"):InvokeServer()
            WindUI:Notify({
                Title = "Success",
                Content = "All Fish have been sold.",
                Duration = 3
            })
        end)
    end
})
local AutoSellToggle = AutoSellTab:Toggle({
    Title = "üõí Auto Sell Caught Fish",

    Desc = "Automatically sell fish based on the catch threshold",
    Default = false,
    Callback = function(state)
        toggleState.AutoSell = state

    end
})

local threshold = 10
-- Input untuk threshold auto sell
local AutoSellThresholdInput = AutoSellTab:Input({
    Title = "üéØ Auto Sell Threshold",
    Desc = "Set the number of fish to catch before auto-selling. Default is 30.",
    Placeholder = "Default: 30",
    Type = "Input",
    Value = 30,
    Callback = function(input)
        local num = tonumber(input)
        if num then
            threshold = num
            WindUI:Notify({
                Title = "Threshold Updated",
                Description = "Fish will be sold automatically when the catch reaches " .. threshold,
                Duration = 1
            })
        else
            WindUI:Notify({
                Title = "Invalid Input",
                Description = "Please enter a number, not text.",
                Duration = 1
            })
        end

    end
})

local thresholdbp = 4990

-- farm tab
local TeleportPoints = {
    ["Mount Hallow"] = {CFrame.new(2146.10425, 80.7497025, 3337.5481, 0.986123204, 1.00192523e-07, 0.166015252,
        -1.03094621e-07, 1, 8.86350282e-09, -0.166015252, -2.58557851e-08, 0.986123204),
                        CFrame.new(2109.61426, 80.3850403, 3332.29028, 0.683332384, 3.65258153e-08, -0.730107427,
        -6.32170583e-08, 1, -9.13899445e-09, 0.730107427, 5.24002175e-08, 0.683332384),
                        CFrame.new(2115.34204, 78.5093842, 3269.48511, -0.921519399, -4.03668174e-08, -0.388332337,
        -6.37460644e-08, 1, 4.73213646e-08, 0.388332337, 6.83622119e-08, -0.921519399),

                        CFrame.new(2142.396, 79.2169952, 3273.90942, -0.961598694, 7.23573308e-08, 0.274459392,
        5.81878297e-08, 1, -5.9768368e-08, -0.274459392, -4.15029895e-08, -0.961598694),
                        CFrame.new(2124.39746, 103.50634, 3339.64087, 0.879151285, -9.63058611e-09, -0.476542771,
        1.75668369e-08, 1, 1.21989494e-08, 0.476542771, -1.90960723e-08, 0.879151285)},
    ["Crystal Craven / Falls"] = {CFrame.new(-1976.01392, -440.025513, 7425.98242, 0.912103653, 2.04608863e-09,
        0.409959644, 2.19213145e-08, 1, -5.37628502e-08, -0.409959644, 5.8024149e-08, 0.912103653),
                                  CFrame.new(-2022.83948, -440.000458, 7428.74023, 0.86662364, 3.24329505e-08,
        -0.498962432, -7.08451431e-09, 1, 5.26960413e-08, 0.498962432, -4.21327258e-08, 0.86662364),
                                  CFrame.new(-2049.09058, -440.000519, 7386.37305, -0.145658955, -4.35237766e-08,
        -0.989334881, 6.06002573e-08, 1, -5.29150945e-08, 0.989334881, -6.76615102e-08, -0.145658955)},

    ["Fisherman Island"] = {CFrame.new(-65.1821136, 3.53157115, 2775.68311, 0.33803311, 3.37374004e-08, 0.941134214,
        3.34767392e-09, 1, -3.7050004e-08, -0.941134214, 1.5674738e-08, 0.33803311)},
    ["Ancient Underground Celar"] = {CFrame.new(2100.39917, -91.1976471, -710.773804, 0.122371674, -6.42108589e-09,
        -0.992484331, 1.06256577e-08, 1, -5.15958387e-09, 0.992484331, -9.9144124e-09, 0.122371674)},
    ["Ancient Sacred Temple"] = {CFrame.new(1462.6908, -22.1250019, -672.93335, -0.147424042, -4.63247218e-08,
        0.989073396, -9.93669929e-08, 1, 3.2025568e-08, -0.989073396, -9.35599047e-08, -0.147424042),
                                 CFrame.new(1462.6908, -22.1250019, -672.93335, -0.147424042, -4.63247218e-08,
        0.989073396, -9.93669929e-08, 1, 3.2025568e-08, -0.989073396, -9.35599047e-08, -0.147424042),
                                 CFrame.new(1492.74304, -10.3161592, -586.368286, 0.322791666, -1.40727296e-08,
        -0.946470022, -6.17820533e-08, 1, -3.59392907e-08, 0.946470022, 7.00757639e-08, 0.322791666),
                                 CFrame.new(1499.65027,... (143 KB left)
